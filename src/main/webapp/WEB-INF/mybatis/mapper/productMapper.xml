<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
	<insert id="insertProductList" parameterType="com.hotbody.hotShop.board.HotShop">
		INSERT INTO 
		productList (pdNum,pdName,pdOrder,pdCreated,pdBoardName,pdContent,pdStCount,pdSumContent,scicode,bclcode,showandhide) 
		values(product_seq.NEXTVAL,#{pdName},1,
				sysdate,#{pdName},#{content},0,#{pdSumContent},#{scicode},#{bclcode},#{showandhide})
	</insert>
	<insert id="insertPmainImg" parameterType="com.hotbody.hotShop.board.HotShop">
	INSERT INTO 
		PmainImg (pmicode,pdNum,imgOriginalFilename,imgSaveFilename) 
		values(PMICODE_SEQ.NEXTVAL,#{pdnum},#{imgOriginalFilename},#{imgSaveFilename})
	</insert>
	<insert id="insertTemporary" parameterType="com.hotbody.hotShop.board.HotShop">
	INSERT INTO 
		Temporary (pdnum,pdPrice,pdNutrient,pdArea,pdStMethod,pdType,pdRawName) 
		values(#{pdnum},#{pdPrice},#{pdNutrient},#{pdArea},#{pdStMethod},#{pdType},#{pdRawName})
	</insert>
	<insert id="insertSchedule" parameterType="com.hotbody.hotShop.board.Schedule">
	INSERT INTO 
		schedule (sdCode,sdName,StartDate,EndDate,startTime,endTime,color)
		 values (schedule_seq.NEXTVAL,#{name},#{startdate},#{enddate},#{starttime},#{endtime},#{color})
	</insert>
	<insert id="insertSupply" parameterType="com.hotbody.hotShop.board.Supply">
		INSERT INTO productIn (pdincode,pdrawprice,pdinnum,pdexdate,pdindate,pdnum,supplycode) 
		 values(pdin_seq.NEXTVAL,#{pdrawprice},#{pdinnum},#{pdexdate},sysdate,#{pdnum},#{supplycode})
	</insert>
	
	<select id="bclSelect" resultType="com.hotbody.hotShop.main.HotBodyMenu">
		SELECT bclcode, name bclname FROM bcl
	</select>
	
	<select id="sciSelect" resultType="com.hotbody.hotShop.main.HotBodyMenu">
		SELECT scicode, name sciname FROM sci WHERE scicode>26
	</select>
	
	<select id="pdInDataCount" resultType="Integer">
		SELECT NVL(COUNT(*),0) FROM productin
	</select>
	<select id="pdListDataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*),0) FROM productList
		<where>
			<if test="cl=='bcl'">
				bclcode=#{code}
			</if>
			<if test="cl=='sci'">
				scicode=#{code}
			</if>
				AND showandhide!=0
		</where>
	</select>
	<select id="readProductNum" parameterType="String" resultType="Integer">
	SELECT pdnum FROM productList WHERE pdName=#{pdName}
	</select>
	<select id="productList" parameterType="map" resultType="com.hotbody.hotShop.board.HotShop">
	SELECT p.pdnum pdnum, imgOriginalFilename, imgSaveFilename, pdName,
			 pdSumContent, pdPrice, pdcontent content,
			pdNutrient, pdStMethod, pdType, pdRawName, pdArea,
			 pdDelRule, pdCreated, pdstCount, (SELECT MIN(TO_CHAR(pdExDate,'YYYY-MM-DD')) FROM productin) pdExDate
				FROM productList p 
				Left OUTER Join Temporary t ON p.pdnum=t.pdnum 
				Left OUTER JOIN Temporary2 t2 ON p.pdnum=t2.pdnum 
				Left OUTER JOIN pmainimg pi ON p.pdnum=pi.pdnum 
				<where>
					<if test="listOrArticle!=0">
						 p.pdnum=#{pdnum}
					</if>
					<if test="cl=='bcl'">
						 bclcode=#{code}
					</if>
					<if test="cl=='sci'">
						 scicode=#{code}
					</if>
					 AND showandhide!=0
				</where>
				ORDER BY 
		<choose>
        	<when test="formal=='created'">
        		pdCreated
        	</when>
        	<when test="formal=='hitCount'">
        		hitCount
        	</when>
        	<when test="formal=='star'">
        		hitCount
        	</when>
        	<otherwise>
        		p.pdcreated
        	</otherwise>
        </choose>
        <choose>
        	<when test="order=='asc'">
        		 asc
        	</when>
        	<otherwise>
        		 DESC
        	</otherwise>
        </choose>
	</select>
	<select id="readProductIn" parameterType="map" resultType="com.hotbody.hotShop.board.ProductIn">
		SELECT * FROM (SELECT ROWNUM rnum, pdin.* FROM (SELECT pdincode,pdrawprice,pdinnum,TO_CHAR(pdexdate, 'YYYY-MM-DD') pdexdate,TO_CHAR(pdindate, 'YYYY-MM-DD') pdindate,pi.pdnum pdnum,pl.pdname pdname,pi.supplycode,supplyname,imgSaveFilename
		FROM productin pi 
		JOIN productList pl ON pi.pdnum=pl.pdnum 
        JOIN supply s ON pi.supplycode=s.supplycode
        LEFT OUTER JOIN pmainimg pimg ON pl.pdnum = pimg.pdnum 
        <where>
        	<if test="startDate!=''">
        	 TO_CHAR(pdindate, 'YYYY-MM-DD')&gt;=#{startDate} AND TO_CHAR(pdindate, 'YYYY-MM-DD')&lt;=#{endDate}
        	</if>
        	<if test="startDate!=''">
        		<if test="colum=='pdexdate'">
	        	 TO_CHAR(pdexdate, 'YYYY-MM-DD')&gt;=#{startDate} AND TO_CHAR(pdexdate, 'YYYY-MM-DD')&lt;=#{endDate}    		
        		</if>
        	</if>
        </where>
         ORDER BY 
        <choose>
        	<when test="colum=='pdexdate'">
        		pdexdate
        	</when>
        	<otherwise>
        		pdincode
        	</otherwise>
        </choose>
        <choose>
        	<when test="order=='asc'">
        		 asc
        	</when>
        	<otherwise>
        		 DESC
        	</otherwise>
        </choose>) pdin WHERE ROWNUM&lt;=#{end})
         WHERE rnum&gt;=#{start}
	</select>
	
	<update id="productListUpdate" parameterType="com.hotbody.hotShop.board.HotShop">
	UPDATE productList 
	SET  
	pdname=#{pdName},
	pdContent=#{content},
	pdSumContent=#{pdSumContent},
	bsl
	 WHERE pdnum=#{pdnum}
	</update>
	<update id="PmainImgUpdate" parameterType="com.hotbody.hotShop.board.HotShop">
	UPDATE PmainImg 
	SET 
	imgOriginalFilename=#{imgOriginalFilename},
	imgSaveFilename=#{imgSaveFilename}
	
	 WHERE pdnum=#{pdnum}
	</update>
	<update id="TemporaryUpdate" parameterType="com.hotbody.hotShop.board.HotShop">
	UPDATE Temporary 
	SET 
	pdPrice=#{pdPrice},
	pdNutrient=#{pdNutrient},
	pdArea=#{pdArea},
	pdStMethod=#{pdStMethod},
	pdType=#{pdType},
	pdRawName=#{pdRawName}
	
	WHERE pdnum=#{pdnum}
	</update>
	<update id="updateHitCount" parameterType="Integer">
		UPDATE productList SET hitCount=hitCount+1 WHERE pdnum=#{pdnum}
	</update>
	
	<select id="supplyList" resultType="com.hotbody.hotShop.board.Supply">
		SELECT supplycode, supplyname, supplytel, supplypd
		FROM supply
	</select>
</mapper>